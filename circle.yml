dependencies:
  pre:
    - sudo apt-get update -qq
    - sudo apt-get install clamav clamav-daemon -qqy
    - sudo freshclam -v
  post:
    - curl -Ls https://install.convox.com/linux.zip > convox.zip
    - sudo unzip convox.zip -d /usr/local/bin
deployment:
  staging:
    branch: master
    commands:
      - convox login console.convox.com
      - convox switch bitzesty/vigilion-eu
      - convox deploy --app scanner-staging:
          timeout: 1800
      - convox run web bundle exec rake db:migrate --app scanner-staging
  production:
    branch: production
    commands:
      - convox login console.convox.com
      - convox switch bitzesty/vigilion-eu
      - convox deploy --app scanner-production:
          timeout: 1800
      - convox run web bundle exec rake db:migrate --app scanner-production
